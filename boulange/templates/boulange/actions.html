{% extends "boulange/base.html" %}

{% block title %}Actions{% endblock %}

{% block content %}
{% if not to_print %}
<section>
  {% for d in date_nav %}
  {% if d == target_date %}
  {{ d|date:"D d/m" }}
  {% else %}
  <a href="{% url 'boulange:actions' d.year d.month d.day %}">{{ d|date:"D d/m" }}</a>
  {% endif %}
  {% endfor %}
</section>
{% else %}
{{ d|date:"D d/m" }}
{% endif %}
{% if actions.bakery %}
{% if section is None or section == 'boulange' %}
<section>
  <h2>
    Boulange
    <a target="_blank" href="{% url 'boulange:actions_print' 'boulange' target_date.year target_date.month target_date.day %}">üñ∂</a>
  </h2>
  Nb de pains cuits : {{ actions.bakery.nb_breads }}
  <div class="flex three">
    {% for recipe, data in actions.bakery.items %}
    <article class="card">
      <header>
	<h3>{{ recipe.get_short_recipe_name }}</h3>
      </header>
      <ul>
        {% for ing, qty in data.ingredients.items %}
        {% if qty|bround:ing %}
        <li>{{ ing }}{% if ing.soaking_ingredient %} (tremp√©){% endif %} : {{ qty|bround:ing }} {{ ing.unit }}</li>
        {% endif %}
        {% endfor %}
      </ul>
      <p>Poids total : {{ data.weight|bround:'total' }} g</p>
      {% with subbatch=actions.bakery.sub_batches|dict_key:recipe %}
      <div>
	{% for subproduct, subingredients in subbatch.items %}
	<b style="margin-left: 15px;">dont {{ subproduct }}</b>
	<ul>
	  {% for subing, subqty in subingredients.items %}
	  {% if subqty|bround:subing != 0%}
	  <li>
	    {{ subing }}{% if subing.soaking_ingredient %} (tremp√©){% endif %} : {{ subqty|bround:subing }} {{ subing.unit }}
	  </li>
	  {% endif %}
	  {% endfor %}
	</ul>
	{% endfor %}
      </div>
      {% endwith %}
      <hr/>
      <h4 style="margin-left: 15px;">Division</h4>
      <ul>
        {% for product, qty in data.division.items %}
        <li>{{ product }} : {{ qty }}</li>
        {% endfor %}
      </ul>
    </article>
    {% endfor %}
  </div>
</section>
{% endif %}
{% endif %}
{% if actions.delivery %}
{% if section is None or section == 'livraison' %}
<section>
  <h2>
    Livraison
    <a target="_blank" href="{% url 'boulange:actions_print' 'livraison' target_date.year target_date.month target_date.day %}">üñ∂</a>
  </h2>
  <div class="flex three">
    {% for delivery_date, lines in actions.delivery.items %}
    <article class="card">
      <header>
	<h3><a href="{% url 'boulange:delivery_receipt' delivery_date.id %}">{{ delivery_date }}</a></h3>
      </header>
      <ul>
        {% for product, nb in lines.items %}
        <li>{{ product }} : {{ nb }}</li>
        {% endfor %}
      </ul>
    </article>
    {% endfor %}
  </div>
</section>
{% endif %}
{% endif %}
{% if actions.preparation.levain_froment_recipe or actions.preparation.levain_sarrasin_recipe or actions.preparation.levain_petit_epeautre_recipe or actions.preparation.trempage %}
{% if section is None or section == 'preparations' %}
<section>
  <h2>
    Pr√©parations
    <a target="_blank" href="{% url 'boulange:actions_print' 'preparations' target_date.year target_date.month target_date.day %}">üñ∂</a>
  </h2>
  <div class="flex three">
    {% if actions.preparation.levain_petit_epeautre_recipe %}
    <article class="card">
      <header>
	<h3>Levain de petit √©peautre</h3>
      </header>
      {% for step in actions.preparation.levain_petit_epeautre_recipe %}
      <h4 style="margin-left: 15px;">{{ step.title }}</h4>
      <ul>
        {% for line in step.lines %}
        <li>{{ line }}</li>
        {% endfor %}
      </ul>
      {% endfor %}
    </article>
    {% endif %}
    {% if actions.preparation.levain_sarrasin_recipe %}
    <article class="card">
      <header>
	<h3>Levain sarrasin</h3>
      </header>
      {% for step in actions.preparation.levain_sarrasin_recipe %}
      <h4 style="margin-left: 15px;">{{ step.title }}</h4>
      <ul>
        {% for line in step.lines %}
        <li>{{ line }}</li>
        {% endfor %}
      </ul>
      {% endfor %}
      <p>‚ö† 20g sont inclus pour le futur levain chef</p>
      {% if target_date.weekday == 3 %}
      <p><b>‚ö† pr√©voir 100g en plus (jeudi)</b></p>
      {% endif %}      
    </article>
    {% endif %}
    {% if actions.preparation.levain_froment_recipe %}
    <article class="card">
      <header>
	<h3>Levain froment</h3>
      </header>
      {% for step in actions.preparation.levain_froment_recipe %}
      <h4 style="margin-left: 15px;">{{ step.title }}</h4>
      <ul>
        {% for line in step.lines %}
        <li>{{ line }}</li>
        {% endfor %}
      </ul>
      {% endfor %}
      <p>‚ö† futur levain chef non inclus</p>
      {% if target_date.weekday == 3 %}
      <p><b>‚ö† pr√©voir 1000g en plus (jeudi)</b></p>
      {% endif %}
    </article>
    {% endif %}
    {% if actions.preparation.trempage %}
    <article class="card">
      <header>
	<h3>Trempage</h3>
      </header>
      <ul>
        {% for name, qties in actions.preparation.trempage.items %}
        <li>{{ name }} : {{ qties.dry|bround:name }} g + {{qties.soaking_ingredient}}: {{ qties.soaking_qty|bround:name }} g<br>{{ qties.warning }}</li>
        {% endfor %}
      </ul>
    </article>
    {% endif %}
  </div>
</section>
{% endif %}
{% endif %}
{% endblock %}
